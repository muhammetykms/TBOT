{% extends "tepe.html" %}

{% block title %}
T-ERP İndikatörler
{% endblock %}

{% load static %}



{% block sayfabasligi %}

{% endblock %}

{% block sagustmap %}
      <li class="breadcrumb-item"><a href="{% url 'home' %}">Genel</a></li>
      <li class="breadcrumb-item">Mumlar</li>

{% endblock %}



{% block content %}

    <h1>Parite EKLE</h1>





  <!-- TradingView Embed Widget -->
<div class="card card-success">
  <div class="card-header">

 <h3 class="card-title"><b>Devam Eden Üretim Süreçleri</b></h3>



  </div>
  <!-- /.card-header -->
  <div class="card-body">
        <div class="row mb-3">
            <form method="POST" id="ajax-form">
                {% csrf_token %}
                <input type="text" id="parite_id" name="parite_name" placeholder="Parite" class="mr-3">
                <button class="btn btn-success" id="parite_ekle_buton">Ekle</button>
            </form>
        </div>

    <table id="example1" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Pariteler</th>
            </tr>
        </thead>
        <tbody>
            {% for item in pariteler %}
                <tr>
                    <td>
                        {{item}}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
</div>




{% endblock %}


{% block footer %}
<p>My custom footer for this page.</p>

<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- DataTables  & Plugins -->
<script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'plugins/jszip/jszip.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/pdfmake.min.js' %}"></script>
<script src="{% static 'plugins/pdfmake/vfs_fonts.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>

<script>
// jQuery kullanarak checkbox güncellemesi
$(document).on("change", ".update-status", function () {
    var checkbox = $(this);
    var pariteintervalId = checkbox.data("id"); // ID'yi al
    var newStatus = checkbox.prop("checked");  // Yeni durumu al (true/false)
    
    // Ajax çağrısı
    $.ajax({
        url: "",  // Aynı URL'ye POST isteği
        type: "POST",
        data: {
            id: pariteintervalId,
            onay: newStatus,
            csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val()  // CSRF token
        },
        success: function (response) {
            if (response.success) {
                alert("Durum başarıyla güncellendi!");
            } else {
                alert("Bir hata oluştu!");
                checkbox.prop("checked", !newStatus);  // Hata durumunda checkbox durumunu geri çevir
            }
        },
        error: function () {
            alert("Bir hata oluştu!");
            checkbox.prop("checked", !newStatus);  // Hata durumunda checkbox durumunu geri çevir
        }
    });
});



</script>

<script>
  $(document).ready(function() {
    // DataTable'ı başlat
    var table = $('#example1').DataTable({
      "responsive": true,
      "lengthChange": false,
      "autoWidth": false,
    });

    // Input alanındaki veriyi dinle ve DataTable'a aktar
    $('#parite_id').on('keyup', function() {
      var value = $(this).val(); // Input alanındaki değeri al
      table.search(value).draw(); // DataTable'da arama yap
    });
  });
</script>


<script>

    $(document).ready(function() {
  // "Parite Ekle" butonuna tıklandığında Ajax çağrısı
  $('#parite_ekle_buton').on('click', function(e) {
    e.preventDefault(); // Formun varsayılan davranışını engelle

    // Input ve CSRF token değerlerini al
    var pariteValue = $('#parite_id').val().trim(); // Input alanındaki değeri al ve boşlukları temizle
    var csrfToken = $("input[name='csrfmiddlewaretoken']").val(); // CSRF tokeni al

    // Boş kontrolü
    if (pariteValue === "") {
      alert("Parite adı boş olamaz!");
      return;
    }

    // Ajax isteği
    $.ajax({
      type: 'POST',
      url: '{% url "mumlar:parite_ekle" %}', // Django'daki "parite_add" URL'ini belirtin
      data: {
        'parite_name': pariteValue,
        'csrfmiddlewaretoken': csrfToken
      },
      success: function(response) {
        if (response.success) {
          // Yeni pariteyi tabloya ekle
          var table = $('#example1').DataTable(); // DataTable örneğini alın
          table.row.add([pariteValue]).draw(false); // DataTable'a yeni satır ekle

          // Input alanını temizle
          $('#parite_id').val('');
        } else {
          alert(response.error || "Parite eklenirken bir hata oluştu.");
        }
      },
      error: function(xhr, status, error) {
        console.error("Ajax hatası: ", error);
        alert("Bir hata oluştu. Lütfen tekrar deneyin.");
      }
    });
  });
});

</script>
{% endblock %}
